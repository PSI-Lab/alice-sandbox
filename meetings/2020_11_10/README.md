

## Compare FE

For predicted best global structure not equal to ground truth,
calculate FE and compare with ground truth.


```
python compare_fe.py ../2020_10_13/data/rand_s1_bb_0p1_global_structs_60.pkl.gz data/rand_s1_bb_0p1_global_structs_60_fe.pkl.gz
```


Result:

- Total: 45885

- With negative free energy (as defined by RNAfold): 32008

![plot/compare_fe.png](plot/compare_fe.png)

- Above plot: comparing FE for all sequences where pred_fe < 0 (as defined by RNAfold)

![plot/compare_fe_wo_perfect_hits.png](plot/compare_fe_wo_perfect_hits.png)

- Above plot: after removing perfect hits (pred struct == RNAfold MFE struct).

- Interestingly, there are also cases where pred_fe < rnafold_fe.
Note that this means the RNAfold struct is not MFE. Not sure why this can happen.

```
FE: rnafold -1.8, pred -4.2
GUCUCUUCAUGGAAGGUCACGU length 22
...(((((...)))))...... [RNAfold]
(((.((((...))))))).... [pred]

FE: rnafold -9.8, pred -10.5
AUCUAAAAGGAGAACGCAUCCAACAAGUCGGAGGGGCAUCCUAC length 44
.......((((...(.(.(((........)))).)...)))).. [RNAfold]
.......((((...(((.(((........))))))...)))).. [pred]

FE: rnafold -3.7, pred -7.2
AUAAACGGCGAAGGUUAGGCAAUGAUCUAGGGGGU length 35
........(..((((((.....))))))..).... [RNAfold]
....((.((..((((((.....))))))..)).)) [pred]

FE: rnafold -1.3, pred -1.4
GGUCACACAGCACGGUAGCGAUAAGGUU length 28
.(((.(((......)).).)))...... [RNAfold]
.(((((...((...)).)))))...... [pred]

FE: rnafold -6.9, pred -8.8
AUCCAUCCCUGCGUAGAUCUUAUUCCAGGGCUC length 33
......(((((.(((.....)))..)))))... [RNAfold]
......(((((.(((((...))))))))))... [pred]

FE: rnafold -16.6, pred -17.1
CCAUUUUCGCCACGGCACAUCCUGGGCGGUGGCGAUCGACGCAGCCCUACACAACG length 56
......(((((((.((.((...)).)).)))))))..................... [RNAfold]
......(((((((.((.((....)))).)))))))..................... [pred]

FE: rnafold -10.4, pred -11.1
GCACAAUUAUUAGGGGGGGGAGCGAUAGAUACGGAGUCGCACGCAUUCUCAA length 52
............((((((.(.(((((.........))))).).).))))).. [RNAfold]
............((((((((.(((((.........))))).))).))))).. [pred]

FE: rnafold -1.5, pred -2.9
GUUCUGGUGCUAAGGCUGCGUA length 22
......((((....)).))... [RNAfold]
.....(((((....)))))... [pred]

FE: rnafold -2.9, pred -5.7
GGUCGAUACGCAGCAUCAAGUUUGGUUUCU length 30
....((.((..(((.....)))..)).)). [RNAfold]
....((.((.((((.....)))).)).)). [pred]
```

As an example, the first sequence:

![plot/example_lower_fe_pred.png](plot/example_lower_fe_pred.png)

Note that both standard and non-standard base pairs exist in the prediction.
(But RNAfold FE computation seems to be OK with it. I think it's using the
full 4x4 stack base pair FE table)

Generated by [plot_fe.ipynb](plot_fe.ipynb)

## TODOs

move to top level util

end to end pipeline


Heuristics: More structure is better -> if global struct A is subset of B, discard A

For predicted best global structure not equal to ground truth, calculate FE and compare with ground truth

Debug stage 1 iloop data

Pseudo knot?

RNA-RNA interaction? Run stage 1 model three times, A-A, B-B & A-B, 2nd stage will have different constraints

Evaluate on another dataset? rfam151?

Long sequence?

Greedy approach of assembly? Start with high prob bounding boxes, terminate after explored say 100 global structures?





